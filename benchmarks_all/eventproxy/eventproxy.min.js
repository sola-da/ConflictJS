!(function(a,b){var c=typeof define==="function",d=typeof module!=="undefined"&&module.exports;if(c){define("eventproxy_debug",function(){return function(){}});define(["eventproxy_debug"],b)}else{if(d){module.exports=b(require("debug")("eventproxy"))}else{this[a]=b()}}})("EventProxy",function(c){c=c||function(){};
/*!
   * refs
   */
;var f=Array.prototype.slice;var d=Array.prototype.concat;var g="__all__";var b=function(){if(!(this instanceof b)){return new b()}this._callbacks={};this._fired={}};b.prototype.addListener=function(h,i){c("Add listener for %s",h);this._callbacks[h]=this._callbacks[h]||[];this._callbacks[h].push(i);return this};b.prototype.bind=b.prototype.addListener;b.prototype.on=b.prototype.addListener;b.prototype.subscribe=b.prototype.addListener;b.prototype.headbind=function(h,i){c("Add listener for %s",h);this._callbacks[h]=this._callbacks[h]||[];this._callbacks[h].unshift(i);return this};b.prototype.removeListener=function(m,o){var k=this._callbacks;if(!m){c("Remove all listeners");this._callbacks={}}else{if(!o){c("Remove all listeners of %s",m);k[m]=[]}else{var n=k[m];if(n){var h=n.length;for(var j=0;j<h;j++){if(o===n[j]){c("Remove a listener of %s",m);n[j]=null}}}}}return this};b.prototype.unbind=b.prototype.removeListener;b.prototype.removeAllListeners=function(h){return this.unbind(h)};b.prototype.bindForAll=function(h){this.bind(g,h)};b.prototype.unbindForAll=function(h){this.unbind(g,h)};b.prototype.trigger=function(k,o){var q,t,u,p,m;var s=2;var v=this._callbacks;c("Emit event %s with data %j",k,o);while(s--){t=s?k:g;q=v[t];if(q){for(p=0,m=q.length;p<m;p++){if(!(u=q[p])){q.splice(p,1);p--;m--}else{var r=[];var h=s?1:0;for(var n=h;n<arguments.length;n++){r.push(arguments[n])}u.apply(this,r)}}}}return this};b.prototype.emit=b.prototype.trigger;b.prototype.fire=b.prototype.trigger;b.prototype.once=function(i,k){var h=this;var j=function(){k.apply(h,arguments);h.unbind(i,j)};this.bind(i,j);return this};var a=(typeof setImmediate!=="undefined"&&setImmediate)||(typeof process!=="undefined"&&process.nextTick)||function(h){setTimeout(h,0)};b.prototype.emitLater=function(){var h=this;var i=arguments;a(function(){h.trigger.apply(h,i)})};b.prototype.immediate=function(h,j,i){this.bind(h,j);this.trigger(h,i);return this};b.prototype.asap=b.prototype.immediate;var e=function(m,l,n,j){var r=this;var o=arguments.length;var i=0;var s={};if(o<3){return this}var v=f.call(arguments,0,-2);var u=arguments[o-2];var t=arguments[o-1];if(typeof u!=="function"){return this}c("Assign listener for events %j, once is %s",v,!!t);var q=function(w){var x=t?"once":"bind";r[x](w,function(y){r._fired[w]=r._fired[w]||{};r._fired[w].data=y;if(!s[w]){s[w]=true;i++}})};var k=v.length;for(var p=0;p<k;p++){q(v[p])}var h=function(x){if(i<k){return}if(!s[x]){return}var y=[];for(var w=0;w<k;w++){y.push(r._fired[v[w]].data)}if(t){r.unbindForAll(h)}c("Events %j all emited with data %j",v,y);u.apply(null,y)};r.bindForAll(h)};b.prototype.all=function(j,i,k){var h=d.apply([],arguments);h.push(true);e.apply(this,h);return this};b.prototype.assign=b.prototype.all;b.prototype.fail=function(i){var h=this;h.once("error",function(){h.unbind();i.apply(null,arguments)});return this};b.prototype.throw=function(){var h=this;h.emit.apply(h,["error"].concat(f.call(arguments)))};b.prototype.tail=function(){var h=d.apply([],arguments);h.push(false);e.apply(this,h);return this};b.prototype.assignAll=b.prototype.tail;b.prototype.assignAlways=b.prototype.tail;b.prototype.after=function(k,m,n){if(m===0){n.call(null,[]);return this}var i=this,h=[];this._after=this._after||{};var l=k+"_group";this._after[l]={index:0,results:[]};c("After emit %s times, event %s's listenner will execute",m,k);var j=function(o,p){if(o===k){m--;h.push(p);if(m<1){c("Event %s was emit %s, and execute the listenner",k,m);i.unbindForAll(j);n.apply(null,[h])}}if(o===l){m--;i._after[l].results[p.index]=p.result;if(m<1){c("Event %s was emit %s, and execute the listenner",k,m);i.unbindForAll(j);n.call(null,i._after[l].results)}}};i.bindForAll(j);return this};b.prototype.group=function(i,l){var j=this;var k=i+"_group";var h=j._after[k].index;j._after[k].index++;return function(m,n){if(m){return j.emit.apply(j,["error"].concat(f.call(arguments)))}j.emit(k,{index:h,result:l?l.apply(null,f.call(arguments,1)):n})}};b.prototype.any=function(){var j=this,m=arguments[arguments.length-1],i=f.call(arguments,0,-1),k=i.join("_");c("Add listenner for Any of events %j emit",i);j.once(k,m);var l=function(n){j.bind(n,function(o){c("One of events %j emited, execute the listenner");j.trigger(k,{data:o,eventName:n})})};for(var h=0;h<i.length;h++){l(i[h])}};b.prototype.not=function(i,j){var h=this;c("Add listenner for not event %s",i);h.bindForAll(function(k,l){if(k!==i){c("listenner execute of event %s emit, but not event %s.",k,i);j(l)}})};b.prototype.done=function(h,j){var i=this;return function(l,m){if(l){return i.emit.apply(i,["error"].concat(f.call(arguments)))}var k=f.call(arguments,1);if(typeof h==="string"){if(j){return i.emit(h,j.apply(null,k))}else{return i.emit.apply(i,[h].concat(k))}}if(arguments.length<=2){return h(m)}h.apply(null,k)}};b.prototype.doneLater=function(i,j){var h=this.done(i,j);return function(l,m){var k=arguments;a(function(){h.apply(null,k)})}};b.create=function(){var h=new b();var j=d.apply([],arguments);if(j.length){var i=j[j.length-1];var k=j[j.length-2];if(typeof i==="function"&&typeof k==="function"){j.pop();h.fail(i)}h.assign.apply(h,j)}return h};b.EventProxy=b;return b});